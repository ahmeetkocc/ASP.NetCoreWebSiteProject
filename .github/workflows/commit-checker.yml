name: Commit Message Check

on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  commit-message-check:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Get commit messages
      run: |
        # Get branch name from the pull request
        BRANCH_NAME=$(echo "${{ github.head_ref }}" | sed 's#/#_#g')
        EXPECTED_PREFIX="[$BRANCH_NAME]"

        # Get commit messages from the pull request
        COMMITS=$(git log --format=%s --no-merges HEAD~20..HEAD)
        
        # Check if each commit message starts with the expected prefix
        for COMMIT_MSG in $COMMITS; do
          if [[ ! "$COMMIT_MSG" =~ ^\[$BRANCH_NAME\] ]]; then
            echo "Hata: Commit mesajı '$COMMIT_MSG' beklenen formatta değil! (Beklenen prefix: '$EXPECTED_PREFIX')"
            exit 1
          fi
        done

    - name: Success message
      if: success()
      run: echo "Tüm commit mesajları doğru formatta."
